@using Newtonsoft.Json
@using SFA.DAS.ApplyService.Application.Services
@using SFA.DAS.ApplyService.Domain.Apply
@model string

@{
    var monthField = 0;
    var tableData = JsonConvert.DeserializeObject<TabularData>(Model);
    if (tableData?.HeadingTitles != null)
    {
        for (var i = 0; i < tableData.HeadingTitles.Count; i++)
        {
            if (tableData.HeadingTitles[i].ToLower() == "month")
            {
                monthField = i + 1;
                break;
            }
        }
    }
}

@if (tableData != null && tableData.HeadingTitles != null && tableData.DataRows != null)
{
    <table class="govuk-table">
        @if (tableData.Caption != null)
        {
            <caption class="govuk-table__caption">
                @tableData.Caption
            </caption>
        }
        <thead class="govuk-table__head">
        <tr class="govuk-table__row">
            @foreach (var title in tableData.HeadingTitles)
            {
                <th class="govuk-table__header" scope="col">@Html.Raw(title)</th>
            }
        </tr>
        </thead>
        <tbody class="govuk-table_body">
        @foreach (var dataRow in tableData.DataRows)
        {
            <tr class="govuk-table__row">
                @for (var index = 0; index < dataRow.Columns.Count; index++)
                {
                    var column = dataRow.Columns[index];
                    if (index+1==monthField)
                    {
                        column = DateOfBirthFormatter.FormatMonth(column);
                    }
                    <td class="govuk-table__cell">@column</td>
                }
            </tr>
        }
        </tbody>
    </table>
