@model SFA.DAS.ApplyService.Web.ViewModels.OrganisationSearchViewModel

@{
    ViewBag.Title = "Confirm organisation";
    Layout = "_Layout";

    bool showErrors = TempData["ShowErrors"] as bool? ?? false;
    var organisation = Model.Organisations?.FirstOrDefault();
    var organisationType = Model.OrganisationTypes?.Where(ot => ot.Type == organisation?.OrganisationType).FirstOrDefault();
}

<a asp-action="Results" asp-controller="OrganisationSearch" asp-route-searchString="@Model.SearchString" class="govuk-back-link">Back to search results</a>

<main class="govuk-main-wrapper " id="main-content" role="main">
    <div class="govuk-grid-row">
        @if (organisation != null)
        {
            <div class="govuk-grid-column-full">
                <form method="post" asp-action="Create" asp-controller="OrganisationSearch" novalidate>
                    <input asp-for="SearchString" type="hidden" />
                    <input asp-for="Name" type="hidden" />
                    <input asp-for="Ukprn" type="hidden" />
                    <input asp-for="OrganisationType" type="hidden" />
                    <input asp-for="Postcode" type="hidden" />

                    @if (!ViewData.ModelState.IsValid || showErrors)
                    {
                        <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="error-summary">
                            <h2 class="govuk-error-summary__title" id="error-summary-title">
                                There is a problem
                            </h2>
                            <div class="govuk-error-summary__body">
                                <ul class="govuk-list govuk-error-summary__list">
                                    @*<li><a class="govuk-link" href="" sfa-validation-for=""></a></li>*@
                                </ul>
                            </div>
                        </div>
                    }

                        <div class="govuk-form-group">
                            <h1 class="govuk-label-wrapper">
                                <label class="govuk-label govuk-label--l" for="Organisation">
                                    Confirm organisation
                                </label>
                            </h1>

                            <p class="govuk-body govuk-!-font-weight-regular govuk-!-margin-bottom-1">
                                <span class="govuk-body govuk-!-font-weight-bold">@organisation.Name</span>
                            </p>

                            <p class="govuk-body govuk-!-font-weight-regular govuk-!-margin-bottom-0">
                                <span class="govuk-body govuk-!-font-weight-bold">Address:</span>
                                <span class="govuk-hint">
                                    @if (organisation.Address?.Postcode == null)
                                    {
                                        @("Unknown")
                                    }
                                    else
                                    {
                                        @string.Join(", ", organisation.Address?.Address1, organisation.Address?.City, organisation.Address.Postcode)
                                    }
                                </span>
                            </p>

                            <p class="govuk-body govuk-!-font-weight-regular govuk-!-margin-bottom-0">
                                <span class="govuk-body govuk-!-font-weight-bold">Trading Name:</span>
                                <span class="govuk-hint">
                                    @(organisation.TradingName ?? organisation.ProviderName)
                                </span>
                            </p>

                            <p class="govuk-body govuk-!-font-weight-regular govuk-!-margin-bottom-0">
                                <span class="govuk-body govuk-!-font-weight-bold">Type:</span>
                                <span class="govuk-hint">
                                    @if (organisationType?.TypeDescription == null)
                                    {
                                        @(Model.OrganisationType ?? "Unknown")
                                    }
                                    else
                                    {
                                        @organisationType.TypeDescription
                                    }
                                </span>
                            </p>

                            <p class="govuk-body govuk-!-font-weight-regular govuk-!-margin-bottom-0">
                                <span class="govuk-body govuk-!-font-weight-bold">UKPRN:</span>
                                <span class="govuk-hint">
                                    @if (organisation.Ukprn == null)
                                    {
                                        @("Unknown");
                                    }
                                    else
                                    {
                                        @organisation.Ukprn
                                    }
                                </span>
                            </p>
                        </div>
                    <button type="submit" class="govuk-button">Confirm</button>
                </form>

                <a asp-action="Results" asp-controller="OrganisationSearch" asp-route-searchString="@Model.SearchString">Choose a different organisation</a>
            </div>
        }
        else
        {
            <div class="govuk-grid-column-full">
                <div class="govuk-form-group">
                    <h1 class="govuk-heading-l">We cannot find your organisation details</h1>
                    <p class="govuk-body">Check the:</p>
                    <ul class="govuk-list govuk-list--bullet">
                        <li>spelling of the name</li>
                        <li><abbr title="UK provider reference number">UKPRN</abbr> is correct</li>
                        <li><abbr title="End-point assessor organisation">EPAO ID</abbr> is correct</li>
                        <li>company number</li>
                        <li>charity number</li>
                    </ul>
                </div>

                <a asp-action="Results" asp-controller="OrganisationSearch" asp-route-searchString="@Model.SearchString">Back to search results</a>
            </div>
        }
    </div>
</main>