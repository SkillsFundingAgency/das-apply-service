(function(n){function f(t){n("#addressLoading").show();n("#enterAddressManually").hide();n("#postcodeServiceUnavailable").hide();n("#address-details").addClass("js-hidden");n.ajax({url:"//services.postcodeanywhere.co.uk/CapturePlus/Interactive/Retrieve/v2.10/json3.ws",dataType:"jsonp",data:{key:"JY37-NM56-JA37-WT99",id:t},timeout:5e3,success:function(t){t.Items.length&&(n("#addressLoading").hide(),n(".js-select-previous-address").hide(),n("#enterAddressManually").show(),n("#addressManualWrapper").unbind("click"),e(t.Items[0]))},error:function(){n("#postcodeServiceUnavailable").show();n("#enterAddressManually").hide();n("#addressLoading").hide();n("#address-details").removeClass("js-hidden")}})}function e(t){var i={".address-manual-input-building-1":t.Line1,".address-manual-input-building-2":t.Line2,".address-manual-input-town-or-city":t.City,".address-manual-input-county":t.Province,".address-manual-input-postcode":t.PostalCode};n(".js-address-panel").removeClass("hidden");n(".js-address-panel ul").empty();n.each(i,function(t,i){n(t).val(i);n(".js-address-panel ul").append("<li>"+i+"<\/li>")});n("#ariaAddressEntered").text("Your address has been entered into the fields below.")}function o(){var t=!1;return n.each({".address-manual-input-building-1":"",".address-manual-input-building-2":"",".address-manual-input-town-or-city":"",".address-manual-input-county":"",".address-manual-input-postcode":""},function(i){n(".js-address-panel ul").append("<li>"+n(i).val()+"<\/li>");n(i).val().length===0||(n("#postcode-search").val().length===0||n("#postcode-search").val(n("#postcode-search").val()+", "),n("#postcode-search").val(n("#postcode-search").val()+n(i).val()),t=!0)}),t&&n(".js-address-panel").removeClass("hidden"),t}function r(){n(".js-address-panel, #addressLookupWrapper").addClass("hidden");n("#addressLookupWrapper").removeClass("hide-nojs");n(".address-manual-input").removeClass("js-hidden");n(".address-manual-input-focus").focus()}var t="",i=n("#postcode-search").val(),u=n(".address-manual-input span.govuk-error-message").length>0;if(o()===!0&&u){r();return}n("#addressLookupWrapper").removeClass("disabled");n("#postcode-search").prop("disabled",!1);n("#enterAddressManually").on("click",function(n){n.preventDefault();r()});n("#postcode-search").keyup(function(){i=n(this).val()});n("#postcode-search").autocomplete({classes:{"ui-autocomplete":"govuk-list"},search:function(){n("#addressLoading").show();n("#enterAddressManually").hide()},source:function(i,r){n.ajax({url:"//services.postcodeanywhere.co.uk/CapturePlus/Interactive/Find/v2.10/json3.ws",dataType:"jsonp",data:{key:"JY37-NM56-JA37-WT99",country:"GB",searchTerm:i.term,lastId:t},timeout:5e3,success:function(t){n("#postcodeServiceUnavailable").hide();n("#addressLoading").hide();n("#enterAddressManually").show();n("#postcode-search").one("blur",function(){n("#enterAddressManually").show();n("#addressLoading").hide()});r(n.map(t.Items,function(n){return{label:n.Text,value:"",data:n}}))},error:function(){n("#postcodeServiceUnavailable").show();n("#enterAddressManually").show();n("#addressLoading").hide();n("#address-details").removeClass("js-hidden")}})},messages:{noResults:function(){return"We can't find an address matching "+i},results:function(n){return"We've found "+n+(n>1?" addresses":" address")+" that match "+i+". Use up and down arrow keys to navigate"}},select:function(i,r){var u=r.item.data,e;u.Next=="Retrieve"?(f(u.Id),t=""):(e=n(this),t=u.Id,n("#addressLoading").show(),n("#enterAddressManually").hide(),n("#postcodeServiceUnavailable").hide(),t==="GBR|"?window.setTimeout(function(){e.autocomplete("search",u.Text)}):window.setTimeout(function(){e.autocomplete("search",u.Id)}))},focus:function(t,i){n("#address-lookup").find(".ui-helper-hidden-accessible").text("To select "+i.item.label+", press enter")},autoFocus:!0,minLength:1,delay:100}).focus(function(){t=""})})(jQuery);