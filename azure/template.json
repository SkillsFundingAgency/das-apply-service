{ "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
"contentVersion": "1.0.0.0",
"parameters": { "serviceName": { "type": "string" },"resourceEnvironmentName": { "type": "string" },"environmentName": { "type": "string" },"sharedEnvResourceGroup": { "type": "string" },"sharedFrontEndAppServicePlanName": { "type": "string" },"sharedFrontEndSubnetResourceId": { "type": "string" },"sharedBackEndAppServicePlanName": { "type": "string" },"sharedBackEndSubnetResourceId": { "type": "string" },"configurationStorageConnectionString": { "type": "securestring" },"loggingRedisConnectionString": { "type": "securestring" },"sharedKeyVaultName": { "type": "string" },"sharedManagementResourceGroup": { "type": "string" },"backEndAccessRestrictions": { "type": "array" },"frontEndAccessRestrictions": { "type": "array" },"uiCustomHostname": { "type": "string" },"uiCertificateName": { "type": "string" },"apiCustomHostname": { "type": "string" },"apiCertificateName": { "type": "string" },"tags": { "type": "object" },"resourceGroupLocation": { "type": "string" },"sharedApimResourceGroup": { "type": "string" },"sharedApimName": { "type": "string" },"sharedSQLServerName": { "type": "string" },"logAnalyticsWorkspaceName": { "type": "string" },"elasticPoolName": { "defaultValue": "",
"type": "string" },"databaseSkuName": { "type": "string",
"defaultValue": "S0" },"databaseTier": { "type": "string",
"defaultValue": "Standard" },"utcValue": { "type": "string",
"defaultValue": "[ utcNow() ]" },"stubAuth": { "type": "string" },"minimumTlsVersion": { "type": "string",
"defaultValue": "TLS1_2" },"ProvidersExemptedFromHavingTrustees": { "type": "string" } },"variables": { "deploymentUrlBase": "https://raw.githubusercontent.com/SkillsFundingAgency/das-platform-building-blocks/master/templates/",
"resourceNamePrefix": "[ concat(\u0027das-\u0027,toLower(parameters(\u0027resourceEnvironmentName\u0027)),\u0027-\u0027 , parameters(\u0027serviceName\u0027)) ]",
"resourceGroupName": "[ concat(variables(\u0027resourceNamePrefix\u0027), \u0027-rg\u0027) ]",
"uiAppServiceName": "[ concat(variables(\u0027resourceNamePrefix\u0027),\u0027ui-as\u0027) ]",
"apiAppServiceName": "[ concat(variables(\u0027resourceNamePrefix\u0027),\u0027api-as\u0027) ]",
"storageAccountName": "[ concat(\u0027das\u0027,toLower(parameters(\u0027resourceEnvironmentName\u0027)),parameters(\u0027serviceName\u0027),\u0027str\u0027) ]",
"databaseName": "[ concat(variables(\u0027resourceNamePrefix\u0027),\u0027-db\u0027) ]",
"applyWebConfigNames": "SFA.DAS.ApplyService:ApplyConfig,SFA.DAS.Apply.GovSignIn",
"privateLinkScopeName": "[ toLower(concat(\u0027das-\u0027, parameters(\u0027resourceEnvironmentName\u0027),\u0027-shared-ampls\u0027)) ]" },"resources": [ { "apiVersion": "2020-06-01",
"name": "[ variables(\u0027resourceGroupName\u0027) ]",
"type": "Microsoft.Resources/resourceGroups",
"location": "[ parameters(\u0027resourceGroupLocation\u0027) ]",
"tags": "[ parameters(\u0027tags\u0027) ]",
"properties": "" },{ "apiVersion": "2020-06-01",
"name": "[ concat(variables(\u0027uiAppServiceName\u0027), \u0027-app-insights-\u0027, parameters(\u0027utcValue\u0027)) ]",
"resourceGroup": "[ variables(\u0027resourceGroupName\u0027) ]",
"type": "Microsoft.Resources/deployments",
"properties": "@{ mode=Incremental; templateLink=; parameters= }" },{ "apiVersion": "2020-06-01",
"name": "[ concat(variables(\u0027apiAppServiceName\u0027), \u0027-app-insights-\u0027, parameters(\u0027utcValue\u0027)) ]",
"resourceGroup": "[ variables(\u0027resourceGroupName\u0027) ]",
"type": "Microsoft.Resources/deployments",
"properties": "@{ mode=Incremental; templateLink=; parameters= }",
"dependsOn": "" },{ "apiVersion": "2020-06-01",
"name": "[ concat(\u0027ui-\u0027,parameters(\u0027uiCertificateName\u0027), \u0027-\u0027, parameters(\u0027utcValue\u0027)) ]",
"resourceGroup": "[ parameters(\u0027sharedEnvResourceGroup\u0027) ]",
"type": "Microsoft.Resources/deployments",
"properties": "@{ mode=Incremental; templateLink=; parameters= }" },{ "apiVersion": "2020-06-01",
"name": "[ concat(\u0027api-\u0027,parameters(\u0027apiCertificateName\u0027), \u0027-\u0027, parameters(\u0027utcValue\u0027)) ]",
"resourceGroup": "[ parameters(\u0027sharedEnvResourceGroup\u0027) ]",
"type": "Microsoft.Resources/deployments",
"properties": "@{ mode=Incremental; templateLink=; parameters= }" },{ "apiVersion": "2020-06-01",
"name": "[ concat(variables(\u0027uiAppServiceName\u0027), \u0027-\u0027, parameters(\u0027utcValue\u0027)) ]",
"resourceGroup": "[ variables(\u0027resourceGroupName\u0027) ]",
"type": "Microsoft.Resources/deployments",
"properties": "@{ mode=Incremental; templateLink=; parameters= }" },{ "apiVersion": "2020-06-01",
"name": "[ concat(variables(\u0027apiAppServiceName\u0027), \u0027-\u0027, parameters(\u0027utcValue\u0027)) ]",
"resourceGroup": "[ variables(\u0027resourceGroupName\u0027) ]",
"type": "Microsoft.Resources/deployments",
"properties": "@{ mode=Incremental; templateLink=; parameters= }" },{ "apiVersion": "2020-06-01",
"name": "[ concat(variables(\u0027storageAccountName\u0027), \u0027-\u0027, parameters(\u0027utcValue\u0027)) ]",
"resourceGroup": "[ variables(\u0027resourceGroupName\u0027) ]",
"type": "Microsoft.Resources/deployments",
"properties": "@{ mode=Incremental; templateLink=; parameters= }" },{ "apiVersion": "2021-04-01",
"name": "[ concat(variables(\u0027apiAppServiceName\u0027), \u0027-apim-subscription-\u0027, parameters(\u0027utcValue\u0027)) ]",
"resourceGroup": "[ parameters(\u0027sharedApimResourceGroup\u0027) ]",
"type": "Microsoft.Resources/deployments",
"properties": "@{ mode=Incremental; templateLink=; parameters= }" },{ "apiVersion": "2021-04-01",
"name": "[ concat(variables(\u0027databaseName\u0027), \u0027-\u0027, parameters(\u0027utcValue\u0027)) ]",
"type": "Microsoft.Resources/deployments",
"resourceGroup": "[ parameters(\u0027sharedEnvResourceGroup\u0027) ]",
"properties": "@{ mode=Incremental; templateLink=; parameters= }" } ],"outputs": { "ResourceGroupName": { "type": "string",
"value": "[ variables(\u0027resourceGroupName\u0027) ]" },"UiAppServiceName": { "type": "string",
"value": "[ variables(\u0027uiAppServiceName\u0027) ]" },"ApiAppServiceName": { "type": "string",
"value": "[ variables(\u0027apiAppServiceName\u0027) ]" },"DatabaseName": { "type": "string",
"value": "[ variables(\u0027databaseName\u0027) ]" } } }
